<html lang="en">
  <head>
    <style>
      .text-font {
        font-size: small;
      }

      .card-design {
        margin: 10px;
      }
      .nav-item:hover{
        background-color: grey!important;
        color: white!important;
        
      }
      .nav-link:hover{
        background-color: grey!important;
        color: white!important;
        
      }
      .navbar{
        border: rgba(255, 30, 30, 0.582) 1px solid;
      }
    </style>

    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <meta
      http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests"
    />
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>

    <div class="header">
      <nav class="navbar navbar-expand-lg bg-light p-4" style="background-color: rgba(203, 252, 227, 0.582)!important;">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"><img class="img-fluid"  src="https://scontent.fyei6-2.fna.fbcdn.net/v/t39.30808-1/239489720_512544036565949_1369849290683847873_n.jpg?stp=c0.0.120.120a_cp0_dst-jpg_e15_p120x120_q65&_nc_cat=101&ccb=1-7&_nc_sid=dbb9e7&_nc_ohc=V34qMO1dGoMAX8yFYpw&_nc_ht=scontent.fyei6-2.fna&oh=00_AT9C6u53MiP6IR7twWsWGViEF73FuyGAp-q4UZeiV9d_RA&oe=628FC411">   OSGeo - Mall Data Application</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/">Home Page</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="https://geomatik.hacettepe.edu.tr/">Hacettepe Geomatik Enginneering </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="">Project Github Page</a>
              </li>
             
             
              
            </ul>
            
          </div>
        </div>
      </nav>

    </div>















    <div class="main">
      <div class="row" style="height: 100%">
        <div
          class="col-4"
          style="
            height: 100%;
            background-color: rgba(203, 252, 227, 0.582)!important;
            top: 5%;
            left: 2%;
            overflow: auto;
            overflow-x: hidden;
            border: 1px solid rgba(255, 30, 30, 0.582);
          "
        >
          <div class="overflow-auto" id="lst-mall"></div>
        </div>

        <div class="col-8">
          <div id="mapdiv"></div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
      integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js"
      integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/2.11/lib/OpenLayers.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>
      $.getJSON("/api/data", function (data) {
        var veri1 = data[0].longitude;
        var veri2 = data[0].latitude;

        map = new OpenLayers.Map("mapdiv");
        map.addLayer(new OpenLayers.Layer.OSM());
        epsg4326 = new OpenLayers.Projection("EPSG:4326"); //WGS 1984 projection
        projectTo = map.getProjectionObject(); //The map projection (Spherical Mercator)

        var lonLat = new OpenLayers.LonLat(veri1, veri2).transform(
          epsg4326, // transform from WGS 1984
          projectTo // to Spherical Mercator Projection
        );

        var zoom = 14;
        map.setCenter(lonLat, zoom);

        var point;
        var length = data.length;
        var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
        //TODO - data haritaya ekleme işlemi
        for (point = 0; point < data.length; point++) {
          var lon = data[point].longitude;
          var lat = data[point].latitude;

          var node = document.createElement("div");

          var element = ` <div class="card card-design m-3">
              <div class="card-body">

                <div class='row'>
                  <div class='col-6'>
                    <h4 class="card-title">${data[point].mall_name}</h4>
                <h6 class="text-muted card-subtitle mb-2">
                  Total Area = ${data[point].total_area}m²
                </h6>
                <h6 class="text-muted card-subtitle mb-2">
                  Total Floor Amount = ${data[point].total_floor}
                </h6>
                    
                    </div>


                  <div class='col-6'>
                    
                    <img class='img-fluid' src='${data[point].photo_url_node}'>
                    
                    </div>

                  </div>

               



                <div class="row">
                  <div class="col-6">
                    <ul class="list-group">
                      <li class="list-group-item">
                        <span class="text-font">Number of Elevator ${
                          data[point].number_elevator
                        }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Free Wifi = ${
                            data[point].free_wifi == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Prayer Room = ${
                            data[point].prayer_room == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Baby Care Room = ${
                            data[point].baby_room == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Infirmary = ${
                            data[point].infirmary == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                    </ul>
                  </div>
                  <div class="col-6">
                    <ul class="list-group">
                      <li class="list-group-item">
                        <span class="text-font">Number of Car Capacity ${
                          data[point].number_parking
                        }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >ATM= ${
                            data[point].atm == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Vale = ${
                            data[point].vale == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Cinema = ${
                            data[point].cinema == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Fitnes Center= ${
                            data[point].fitness_center == true
                              ? '<i class="bi bi-check-lg"></i>'
                              : '<i class="bi bi-x-lg"></i>'
                          }</span>
                      </li>
                      <li class="list-group-item">
                        <span class="text-font"
                          >Electric Car Charge = ${
                            data[point].car_charge
                          }</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>`;

          var description = `<div class="container text-center">
      <div class="col">
        <img class='img-fluid' width="60%" height="60%" src='${data[point].photo_url_node}'>
        <div class="row"><h5>${data[point].mall_name}</h5></div>
        <div class="row">
          <div class="col-6">${data[point].longitude}</div>
          <div class="col-6">${data[point].latitude}</div>
        </div>
        <div class="row"><p>Number of Store: ${data[point].shop_number}</p></div>
        
      </div>
    </div>`;

          node.innerHTML = element;
          var listDiv = document.getElementById("lst-mall");
          listDiv.appendChild(node);

          var feature = new OpenLayers.Feature.Vector(
            new OpenLayers.Geometry.Point(lon, lat).transform(
              epsg4326,
              projectTo
            ),
            { description: description },
            {
              externalGraphic:
                "https://upload.wikimedia.org/wikipedia/commons/f/f2/678111-map-marker-512.png",
              graphicHeight: 50,
              graphicWidth: 40,
              graphicXOffset: -12,
              graphicYOffset: -25,
            }
          );
          vectorLayer.addFeatures(feature);
        }

        map.addLayer(vectorLayer);

        //Add a selector control to the vectorLayer with popup functions
        var controls = {
          selector: new OpenLayers.Control.SelectFeature(vectorLayer, {
            onSelect: createPopup,
            onUnselect: destroyPopup,
          }),
        };

        function createPopup(feature) {
          feature.popup = new OpenLayers.Popup.FramedCloud(
            "pop",
            feature.geometry.getBounds().getCenterLonLat(),
            null,
            '<div class="markerContent" style="height:100%;padding:20px">' +
              feature.attributes.description +
              "</div>",
            null,
            true,
            function () {
              controls["selector"].unselectAll();
            }
          );
          //feature.popup.closeOnMove = true;
          map.addPopup(feature.popup);
        }

        function destroyPopup(feature) {
          feature.popup.destroy();
          feature.popup = null;
        }

        map.addControl(controls["selector"]);
        controls["selector"].activate();
      });
    </script>
  </body>
</html>
